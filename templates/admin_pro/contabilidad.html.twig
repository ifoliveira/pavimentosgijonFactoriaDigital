{% extends 'inicio2.html.twig' %}
{% block eltiempo %} {% endblock %}
{% block stylesheets %}
            <!-- This page plugin CSS -->
            <link href="{{ asset('assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css') }}" rel="stylesheet">
            <!-- Custom CSS -->
            <link href="{{ asset('dist/css/style.min.css') }}" rel="stylesheet">
            <!-- This page CSS -->
            <link href="{{ asset('assets/libs/jquery-steps/jquery.steps.css') }}" rel="stylesheet">
            <link href="{{ asset('assets/libs/jquery-steps/steps.css') }}" rel="stylesheet">
            <!-- Popup CSS -->
            <link href="{{ asset('assets/libs/magnific-popup/dist/magnific-popup.css') }}" rel="stylesheet">
            <!-- This Page CSS -->
                <link rel="stylesheet" type="text/css" href="{{ asset('assets/libs/summernote/dist/summernote-bs4.css') }}">
                <link rel="stylesheet" type="text/css" href="{{ asset('assets/extra-libs/prism/prism.css') }}">
                <link href="{{ asset('dist/css/icons/themify-icons/themify-icons.css') }}" rel="stylesheet">   
          <!-- This page plugin CSS -->
          <!-- This Page CSS -->
                <link rel="stylesheet" type="text/css"  href="{{ asset('assets/libs/select2/dist/css/select2.min.css') }}"/>                     
{% endblock %}
{% block cabecera %} Resumen económico {% endblock %}
{% block breadcrumb %} <li class="breadcrumb-item active">Resumen económico</li>{% endblock %}
{% block title %}Resumen económico{% endblock %}
{% block tablas %}{% endblock %}
{% block cardbody1 %}
                <!-- ============================================================== -->
                <!-- End Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <!-- row -->
                    <div class="row">
                                <h3> Cuentas generales</h3>
                    <!-- Column -->
                                <div class="col-sm-12 col-md-9 col-xl-6">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-3 align-self-center">
                                            <h4 class="mb-0">Total Banco</h4>
                                            <span class="text-muted">{{ bancototal["max(fecha_bn)"] |date("m/d/Y", "Europe/Paris")}}</span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{ bancototal["sum(importe_bn)"] |format_currency('EUR', locale='es')}}</h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-9 col-xl-6">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="paperclip" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-3 align-self-center">
                                            <h4 class="mb-0">Total Efectivo</h4>
                                            <span class="text-muted">Efectivo actual</span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{ efectivototal["efectivototal"] |format_currency('EUR', locale='es')}}</h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>  
                    </div>  

                    <div class="row">
                    <!-- Column -->
                                <h3> Datos de ventas</h3>
                                <div class="col-sm-12 col-md-4 col-xl-4">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Ventas totales</h4>
                                            <span class="text-muted">Ventas totales</span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{ beneficio["pvp"]|format_currency('EUR', locale='es')}}</h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-xl-4">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Beneficio Total</h4>
                                            {%  if beneficio["precio"] > 0 %}
                                            <span class="text-muted">{{(((beneficio["pvp"] - beneficio["precio"]) / (beneficio["precio"]))* 100)|number_format(2)}} %</span>
                                            {%  endif %}
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{ (beneficio["pvp"] - beneficio["precio"])|format_currency('EUR', locale='es')}}</h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>    
                                <div class="col-sm-12 col-md-4 col-xl-4">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Pendiente de cobro</h4>
                                            <span class="text-muted"></span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{pendiente|format_currency('EUR', locale='es')}} </h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>                                                              
                    </div>                                                     

                  <!-- Row -->

                   <div class="row">
                    <!-- Column -->
                            <h3> Datos Mano de Obra</h3>
                                <div class="col-sm-12 col-md-3 col-xl-3">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Mano de Obra</h4>
                                            <span class="text-muted">Totales</span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{ cobrosMo|format_currency('EUR', locale='es')}}</h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-3 col-xl-3">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Diferencia Total</h4>
                                            {%  if cobrosMo > 0 %}

                                            <span class="text-muted">{{(((cobrosMo - pagosMo) / (cobrosMo))* 100)|number_format(2)}} %</span>
                                            {% endif %}
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{ (cobrosMo - pagosMo)|format_currency('EUR', locale='es')}}</h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>    
                                <div class="col-sm-12 col-md-3 col-xl-3">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Pendiente de cobro</h4>
                                            <span class="text-muted"></span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{pendientecobroMo|format_currency('EUR', locale='es')}} </h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>       
                                <div class="col-sm-12 col-md-3 col-xl-3">
                                    <div class="card">
                                        <div class="card-body">
                                        <div class="d-flex flex-row">
                                            <div class="round align-self-center round-success">
                                            <i data-feather="dollar-sign" class="feather-sm"></i>
                                            </div>
                                            <div class="ms-4 align-self-center">
                                            <h4 class="mb-0">Pendiente de pago</h4>
                                            <span class="text-muted"></span>
                                            </div>
                                            <div class="ms-auto align-self-center">
                                            <h2 class="font-weight-medium mb-0">{{pendientepagoMo|format_currency('EUR', locale='es')}} </h2>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>                                                                                           
                    </div>                                                     

              <!-- Row -->     
                                <!-- Footer callback -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Costes no informados</h4>
                                <h6 class="card-subtitle"></h6>
                                <div class="table-responsive">
                                    <table id="default_order2" class="table table-striped table-bordered display"
                                        style="width:100%">
                                            <thead>
                                                <tr>
                                                    <th>Id</th>
                                                    <th>PVP</th>
                                                    <th>Coste</th>
                                                    <th>Producto</th>
                                                 
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                        <tbody>
                                            {% for cesta in cestas %}
                                                <tr>
                                                    <td>{{ cesta.cestaDc.id }}</td>
                                                    <td align="right">{{ cesta.pvpDc|format_currency('EUR', locale='es')  }}</td>
                                                    <td align="right">{{ cesta.precioDc|format_currency('EUR', locale='es')  }}</td>
                                                    <td>{{ cesta.productoDc.descripcionPd }}</td>
                                                    <td><a class="text-inverse pr-2" data-toggle="tooltip" title="Modificar coste" name="modifica_coste" id="{{ cesta.id }}" >
                                                            <i class="ti-money"></i>                                                        
                                                    </a></td>
                                                </tr>
                                            {% else %}
                                                <tr>
                                                    <td colspan="8">no records found</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


          
{% endblock %}
{% block jscustom %}

    <!--This page plugins -->
    <script src="../../assets/libs/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="../../dist/js/pages/datatable/custom-datatable.js"></script>
    <script src="{{ asset('dist/js/pages/datatable/datatable-advanced.init.js') }}"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="{{ asset('assets/extra-libs/sparkline/sparkline.js') }}"></script>
    <script src="{{ asset('dist/js/ConectorJavaScript.js') }}"></script>
    <!--Wave Effects -->
    <script src="{{ asset('dist/js/waves.js') }}"></script>
    <!--This page plugins -->
    <script src="{{ asset('assets/extra-libs/datatables.net/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('assets/extra-libs/datatables.net-bs4/js/dataTables.responsive.min.js') }}"></script>
    <script src="{{ asset('dist/js/pages/datatable/datatable-basic.init.js') }}"></script>
    <!--Custom JavaScript -->
    <script src="{{ asset('assets/libs/sweetalert2/dist/sweetalert2.all.min.js') }}"></script>
    <script src="{{ asset('assets/extra-libs/sweetalert2/sweet-alert.init.js') }}"></script>    
    
    <script language = "javascript">
    $(document).ready(function(){   

        $(document).on('click', 'a[name="modifica_coste"]' , function(event) {

            let id = this.id;
            let importe = 0;
            const inputValue = Number(importe).toFixed(2);
            const importe2 = 0;
            const inputStep = 1;

            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-success',
                    cancelButton: 'mr-2 btn btn-danger',
                    denyButton: 'mr-2 btn btn-danger'
                },
                buttonsStyling: false,

            })

            swalWithBootstrapButtons.fire({
            
             
                title: 'IMPORTE',
                text: "Importe coste" ,
                type: 'question',
                html: `
                    <input type="number" value="${inputValue}" step="${inputStep}" class="swal2-input" id="range-value" text-align="right">`,
                showCancelButton: true,
                confirmButtonText: 'Modificar',
                cancelButtonText: 'Pagar',
                reverseButtons: true
                }).then((result) => {
                const inputNumber = Swal.getContent().querySelector('#range-value');
                importe = inputNumber.value;
                if (result.value) {

                    actualiza_importe(id,importe); 

                } else if (
                    // Read more about handling dismissals
                    result.dismiss === Swal.DismissReason.cancel
                ) {

                }

            })
            });     

            function actualiza_importe (id,importe) 
            {
                $.ajax({  
                url:        '../admin/importe/ajax',  
                type:       'GET',   
                data:        ({importe:importe ,id:id}),
                dataType:   'json',  
                async:      true,  
                
                success: function(response) {  
                    location.reload();   
                },  
                error : function(xhr, textStatus, errorThrown) {  
                    alert(textStatus);  
                }                      
                });
            };

      });  
   </script> 
{% endblock %}

